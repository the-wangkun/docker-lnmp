server {
    server_name  ett.ehsy.com;
    listen       80;

    # root   /home/kenney-wang/Projects/opc-eis/src;
    root   /var/www/html/opc-eis/src;
    index  index.php index.html index.htm;
    #charset koi8-r;
    
    access_log /var/log/nginx/access.ett.ehsy.com.log;
    error_log  /var/log/nginx/error.ett.ehsy.com.log  warn;


    # proxy the PHP scripts to Apache listening on 127.0.0.1:80
    #
    #location ~ \.php$ {
    #    proxy_pass   http://127.0.0.1;
    #}

    # 禁用 Nginx 默认错误页面，显示 PHP 错误
    fastcgi_intercept_errors off;

    # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
    #
    # PHP文件解析【核心修改】
    location ~ \.php$ {
        try_files $uri =404;
        fastcgi_pass php71:9000; # 容器名:9000（和PHP-FPM端口一致）
        fastcgi_index index.php;
        fastcgi_connect_timeout 300s;
        fastcgi_send_timeout 300s;
        fastcgi_read_timeout 300s;
        fastcgi_buffer_size 128k;
        fastcgi_buffers 4 256k;
        fastcgi_busy_buffers_size 256k;
        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
        include fastcgi_params;
    }

    location / {

        location /article/product- {
            rewrite ^/article/product-([0-9]+)(|/)$ /index.php?route=cms/category&id=$1 last;
        }
        location /article/news_detail {
            rewrite ^/article/news_detail-([0-9]+)(|/)$ /index.php?route=cms/news/detail&id=$1 last;
        }
        location /article/news {
            rewrite ^/article/news(|/)$ /index.php?route=cms/news last;
        }
        location /article/fair_detail- {
            rewrite ^/article/fair_detail-([0-9]+)(|/)$ /index.php?route=cms/expo/detail&id=$1 last;
        }
        location /article/fair {
            rewrite ^/article/fair(|/)$ /index.php?route=cms/expo last;
        }
        location /article/tag- {
            rewrite ^/article/tag-([0-9]+)(|/)$ /index.php?route=cms/tag&id=$1 last;
        }

        location /article {
            rewrite ^/article(|/)$ /index.php?route=cms/index last;
        }

        location ~ ^/(download\/app) {
            rewrite ^/(.*)$ http://static.ehsy.com/www/files/ehsy.apk;
        }
        location ~ ^/(appDownload|jsp\/app_download.html) {
            rewrite ^/(.*)$ http://a.app.qq.com/o/simple.jsp?pkgname=com.ehsy.western;
        }

        location ~* \.(asp) {
            return 403;
        }
        index index.php;
        try_files $uri $uri/ $uri/index.php /index.php?$args;


        #web rewrite
        #@sam
        rewrite ^/agreementGoods$ /index.php?route=agreement/result last;
        rewrite ^/agreementPurchaseGoods$ /index.php?route=agreement/result/purchase last;
        rewrite ^/stockupGoods$ /index.php?route=stockup/result last;
        rewrite ^/stockupPurchaseGoods$ /index.php?route=stockup/result/purchase last;


        #web product
        rewrite ^/product-(.*)$ /index.php?route=product/info&sku=$1 last;
        rewrite ^/category-([0-9]+)$ /index.php?route=category/result&cid=$1 last;
        rewrite ^/search$ /index.php?route=search/result last;
        rewrite ^/brand-([0-9]+)$ /index.php?route=brand/info&bid=$1 last;
        rewrite ^/boutique-([0-9]+)$ /index.php?route=boutique/info&id=$1 last;
        rewrite ^/brand/list$ /index.php?route=brand/result last;
        rewrite ^/lexicon/params/([0-9]+)$ /index.php?route=search/result/seo_parm&kid=$1 last;
        rewrite ^/lexicon/price/([0-9]+)$ /index.php?route=search/result/seo_price&kid=$1 last;
        rewrite ^/lexicon/image/([0-9]+)$ /index.php?route=search/result/seo_image&kid=$1 last;
        rewrite ^/lexicon/brand/([0-9]+)$ /index.php?route=search/result/seo_brand&kid=$1 last;
        rewrite ^/category/list$ /index.php?route=category/sitemap last;

        #web about
        rewrite ^/about$ /index.php?route=page/info last;
        rewrite ^/news$ /index.php?route=page/news last;
        #web help
        rewrite ^/help_center/first$ /index.php?route=help/info last;
        rewrite ^/help_center/(.*)$ /index.php?route=help/info&id=$1 last;
        #web activity
        rewrite ^/activity/(.*)$ /index.php?route=page/activity&code=$1 last;
        #web page
        rewrite ^/intro_ehsy$ /index.php?route=page/event&code=intro_ehsy last;
        rewrite ^/about_ehsy$ /index.php?route=page/event&code=about_ehsy last;
        rewrite ^/about_mro$ /index.php?route=page/event&code=about_mro last;
        rewrite ^/agreement$ /index.php?route=page/event&code=agreement last;
        rewrite ^/lossleaderGoods$ /index.php?route=lossleader/result last;
        rewrite ^/lossleaderPurchaseGoods$ /index.php?route=lossleader/result/purchase last;
        rewrite ^/contact$ /index.php?route=page/event&code=contact last;
        rewrite ^/copyright$ /index.php?route=page/event&code=copyright last;
        rewrite ^/delivery$ /index.php?route=page/event&code=delivery last;
        rewrite ^/faq$ /index.php?route=page/event&code=faq last;
        rewrite ^/investment$ /index.php?route=page/event&code=investment last;
        rewrite ^/mro$ /index.php?route=page/event&code=mro last;
        rewrite ^/privacy$ /index.php?route=page/event&code=privacy last;
        rewrite ^/recruit$ /index.php?route=page/event&code=recruit last;
        rewrite ^/statement$ /index.php?route=page/event&code=statement last;
        rewrite ^/supplier$ /index.php?route=page/event&code=supplier last;
        rewrite ^/stock_supplier$ /index.php?route=page/event&code=stock_supplier last;

        rewrite ^/lionPostStationPurchaseGoods$ /index.php?route=lion_post_station/result/purchase last;
        rewrite ^/lionPostStationGoods$ /index.php?route=lion_post_station/result last;

        #web account
        rewrite ^/login$ /index.php?route=account/login last;
        rewrite ^/user/register-company$ /index.php?route=account/register&regtype=company last;
        rewrite ^/user/register-personal$ /index.php?route=account/register&regtype=person last;
        #web punchout
        rewrite ^/api/punchout-login-old$ /index.php?route=punchout/login last;
        rewrite ^/punchout/login$ /index.php?route=punchout/login/newLogin last;
        rewrite ^/punchout-login$ /index.php?route=punchout/login last;
        rewrite ^/(.*)/checkin$ /index.php?route=punchout/login&code=$1 last;
        rewrite ^/(.*)/createOrder$ /index.php?route=punchout/checkout/createFormalOrder&code=$1 last;
        rewrite ^/(.*)/createXmlOrder$ /index.php?route=punchout/checkout/createFormalOrderByXml&code=$1 last;
        #web pay
        rewrite ^/checkout/success$ /index.php?route=checkout/checkout_result last;
        rewrite ^/checkout/failure$ /index.php?route=checkout/checkout_result/failure last;
        #web eas
        rewrite ^/checkout/eps_check$ /index.php?route=account/purchase_approve/detail last;
        rewrite ^/checkout/eas_select$ /index.php?route=account/purchase_approve/history last;

        #web category
        rewrite ^/pneumatics$ /index.php?route=category/list&cid=1 last;
        rewrite ^/office-supplies$ /index.php?route=category/list&cid=2 last;
        rewrite ^/labs$ /index.php?route=category/list&cid=3 last;
        rewrite ^/fasteners$ /index.php?route=category/list&cid=4 last;
        rewrite ^/tools$ /index.php?route=category/list&cid=5 last;
        rewrite ^/low-voltage$ /index.php?route=category/list&cid=6 last;
        rewrite ^/ppe$ /index.php?route=category/list&cid=8 last;
        rewrite ^/carry$ /index.php?route=category/list&cid=10 last;
        rewrite ^/measuring-tools$ /index.php?route=category/list&cid=11 last;
        rewrite ^/instruments$ /index.php?route=category/list&cid=2005 last;
        rewrite ^/pumps$ /index.php?route=category/list&cid=1256 last;
        rewrite ^/bearings$ /index.php?route=category/list&cid=12239 last;
        rewrite ^/welding$ /index.php?route=category/list&cid=12240 last;
        rewrite ^/machine-tools$ /index.php?route=category/list&cid=12833 last;
        rewrite ^/hvac$ /index.php?route=category/list&cid=12856 last;
        rewrite ^/lubricants$ /index.php?route=category/list&cid=13679 last;
        rewrite ^/industrial-control$ /index.php?route=category/list&cid=13680 last;
        rewrite ^/replacement-parts$ /index.php?route=category/list&cid=16884 last;
        rewrite ^/hydraulics$ /index.php?route=category/list&cid=16915 last;
        rewrite ^/belts$ /index.php?route=category/list&cid=16916 last;
        rewrite ^/mechanics$ /index.php?route=category/list&cid=16917 last;
        rewrite ^/cleaning$ /index.php?route=category/list&cid=16918 last;
        rewrite ^/lighting$ /index.php?route=category/list&cid=16919 last;
        rewrite ^/seals$ /index.php?route=category/list&cid=16920 last;
        rewrite ^/electrical$ /index.php?route=category/list&cid=16921 last;
        rewrite ^/security$ /index.php?route=category/list&cid=16922 last;
        rewrite ^/fire-protection$ /index.php?route=category/list&cid=16923 last;
        rewrite ^/storage$ /index.php?route=category/list&cid=16924 last;
        rewrite ^/package-material$ /index.php?route=category/list&cid=16925 last;
        rewrite ^/cutting-tools$ /index.php?route=category/list&cid=16926 last;
        rewrite ^/valves-pipe-joints$ /index.php?route=category/list&cid=16927 last;
        rewrite ^/abrasives$ /index.php?route=category/list&cid=16928 last;
        rewrite ^/refrigeration$ /index.php?route=category/list&cid=16929 last;
        rewrite ^/adhesives$ /index.php?route=category/list&cid=16930 last;
        rewrite ^/workshop-chemicals$ /index.php?route=category/list&cid=16931 last;
        rewrite ^/work-station$ /index.php?route=category/list&cid=16932 last;

        rewrite ^/punchout/api/accessToken$ /index.php?route=punchout/api/accessToken last;
        rewrite ^/punchout/api/trustedLogin$ /index.php?route=punchout/api/trustedLogin last;
        rewrite ^/punchout/api/login$ /index.php?route=punchout/api/login last;
        rewrite ^/punchout/api/newLogin$ /index.php?route=punchout/api/newLogin last;
        rewrite ^/punchout/api/authLogin$ /index.php?route=account/auth2/signIn last;
        rewrite ^/punchout/api/confirmOrder$ /index.php?route=punchout/api/confirmOrder last;
        rewrite ^/punchout/api/cancelOrder$ /index.php?route=punchout/api/cancelOrder last;
        rewrite ^/punchout/api/logistics$ /index.php?route=punchout/api/logistics last;
        rewrite ^/punchout/api/package$ /index.php?route=punchout/api/package last;
        rewrite ^/punchout/api/packageLogistics$ /index.php?route=punchout/api/packageLogistics last;
        rewrite ^/punchout/api/checkSkuBuy$ /index.php?route=punchout/api/checkSkuBuy last;
        rewrite ^/punchout/api/punchoutSearch$ /index.php?route=punchout/api/punchoutSearch last;
        rewrite ^/punchout/api/punchoutAddCart$ /index.php?route=punchout/api/punchoutAddCart last;
        rewrite ^/punchout/api/submitOrder$ /index.php?route=punchout/api/submitOrder last;
        rewrite ^/punchout/api/punchoutAddUser$ /index.php?route=punchout/api/punchoutAddUser last;
        rewrite ^/punchout/api/punchoutUsers$ /index.php?route=punchout/api/punchoutUsers last;
        rewrite ^/punchout/api/acceptApprovalResult$ /index.php?route=punchout/api/acceptApprovalResult last;
        rewrite ^/punchout/api/getOrder$ /index.php?route=punchout/api/getOrder last;
        rewrite ^/punchout/api/createAfterSaleOrder$ /index.php?route=punchout/api/createAfterSaleOrder last;
        rewrite ^/punchout/api/getAfterSaleOrders$ /index.php?route=punchout/api/getAfterSaleOrders last;

        rewrite ^/punchout/api/easConfirmOrder$ /index.php?route=punchout/api/easConfirmOrder last;
        rewrite ^/punchout/api/easCancelOrder$ /index.php?route=punchout/api/easCancelOrder last;
        rewrite ^/punchout/api/easToken$ /index.php?route=punchout/api/easToken last;
        rewrite ^/punchout/api/easLogin$ /index.php?route=punchout/api/easLogin last;
        rewrite ^/api/approveOrder$ /index.php?route=api/order/approve last;

    }
    
    # deny access to .htaccess files, if Apache's document root
    # concurs with nginx's one
    #
    #location ~ /\.ht {
    #    deny  all;
    #}
}
